# Test info

- Name: Cart System >> Guest cart and login flow
- Location: C:\Users\henry\OneDrive\Documents\uni\ICT-S4\COMP3036\Major\comp3036b2c\tests\e2e\cart\optimized-cart.spec.ts:132:7

# Error details

```
TimeoutError: page.goto: Timeout 10000ms exceeded.
Call log:
  - navigating to "http://localhost:3000/", waiting until "load"

    at C:\Users\henry\OneDrive\Documents\uni\ICT-S4\COMP3036\Major\comp3036b2c\tests\e2e\cart\optimized-cart.spec.ts:134:16
```

# Test source

```ts
   34 |     }
   35 |     
   36 |     await page.click('[data-testid="add-to-cart"]');
   37 |     await expect(page.locator('[data-testid="cart-badge"]')).toHaveText('1');
   38 |     
   39 |     // Add second product
   40 |     await page.goto('/');
   41 |     await products.nth(1).click();
   42 |     await page.waitForLoadState('networkidle');
   43 |     await page.click('[data-testid="add-to-cart"]');
   44 |     await expect(page.locator('[data-testid="cart-badge"]')).toHaveText('2');
   45 |     
   46 |     // Step 2: View and manage cart
   47 |     await page.click('[data-testid="cart-button"]');
   48 |     await expect(page.locator('[data-testid="cart-modal"]')).toBeVisible();
   49 |     
   50 |     const cartItems = page.locator('[data-testid="cart-item"]');
   51 |     expect(await cartItems.count()).toBe(2);
   52 |     
   53 |     // Step 3: Update quantities
   54 |     const firstItemQty = cartItems.first().locator('[data-testid="quantity-input"]');
   55 |     await firstItemQty.fill('3');
   56 |     await page.click('[data-testid="update-cart"]');
   57 |     
   58 |     // Verify total updates
   59 |     const cartTotal = page.locator('[data-testid="cart-total"]');
   60 |     const totalText = await cartTotal.textContent();
   61 |     expect(totalText).toMatch(/\$\d+\.\d{2}/);
   62 |     
   63 |     // Step 4: Remove item
   64 |     await cartItems.first().locator('[data-testid="remove-item"]').click();
   65 |     await expect(page.locator('[data-testid="cart-badge"]')).toHaveText('3'); // 3 from second item
   66 |     
   67 |     // Step 5: Test cart persistence
   68 |     await page.goto('/');
   69 |     await expect(page.locator('[data-testid="cart-badge"]')).toHaveText('3');
   70 |     
   71 |     // Navigate to different pages and verify persistence
   72 |     await page.goto('/search?q=shirt');
   73 |     await expect(page.locator('[data-testid="cart-badge"]')).toHaveText('3');
   74 |     
   75 |     // Step 6: Clear cart
   76 |     await page.click('[data-testid="cart-button"]');
   77 |     await page.click('[data-testid="clear-cart"]');
   78 |     await expect(page.locator('[data-testid="cart-badge"]')).not.toBeVisible();
   79 |     
   80 |     // Verify all cart operations work
   81 |     expect(await page.locator('[data-testid="cart-badge"]').isVisible()).toBe(false);
   82 |   });
   83 |
   84 |   test('Cart checkout integration and validation', async ({ page }) => {
   85 |     await helpers.loginUser(testUsers.validUser);
   86 |     
   87 |     // Step 1: Add product to cart
   88 |     await page.goto('/');
   89 |     const product = page.locator('[data-testid="product-card"]').first();
   90 |     await product.click();
   91 |     await page.click('[data-testid="add-to-cart"]');
   92 |     
   93 |     // Step 2: Proceed to checkout
   94 |     await page.click('[data-testid="cart-button"]');
   95 |     await page.click('[data-testid="checkout-button"]');
   96 |     await page.waitForURL('/checkout');
   97 |     
   98 |     // Step 3: Verify checkout form
   99 |     await expect(page.locator('[data-testid="shipping-form"]')).toBeVisible();
  100 |     await expect(page.locator('[data-testid="payment-form"]')).toBeVisible();
  101 |     
  102 |     // Step 4: Test form validation
  103 |     await page.click('[data-testid="place-order"]');
  104 |     await expect(page.locator('[data-testid="validation-error"]')).toBeVisible();
  105 |     
  106 |     // Step 5: Fill shipping information
  107 |     await page.fill('[data-testid="address-street"]', '123 Test Street');
  108 |     await page.fill('[data-testid="address-city"]', 'Test City');
  109 |     await page.fill('[data-testid="address-state"]', 'Test State');
  110 |     await page.fill('[data-testid="address-zip"]', '12345');
  111 |     
  112 |     // Step 6: Test inventory validation
  113 |     // This tests the backend inventory check
  114 |     await page.click('[data-testid="place-order"]');
  115 |     
  116 |     // Should either succeed or show inventory error
  117 |     const orderSuccess = page.locator('[data-testid="order-success"]');
  118 |     const inventoryError = page.locator('[data-testid="inventory-error"]');
  119 |     
  120 |     const isSuccess = await orderSuccess.isVisible().catch(() => false);
  121 |     const isInventoryError = await inventoryError.isVisible().catch(() => false);
  122 |     
  123 |     expect(isSuccess || isInventoryError).toBe(true);
  124 |     
  125 |     if (isSuccess) {
  126 |       // Verify order completion
  127 |       await page.waitForURL('/order-summary');
  128 |       await expect(page.locator('[data-testid="order-details"]')).toBeVisible();
  129 |     }
  130 |   });
  131 |
  132 |   test('Guest cart and login flow', async ({ page }) => {
  133 |     // Step 1: Add items as guest
> 134 |     await page.goto('/');
      |                ^ TimeoutError: page.goto: Timeout 10000ms exceeded.
  135 |     const product = page.locator('[data-testid="product-card"]').first();
  136 |     await product.click();
  137 |     await page.click('[data-testid="add-to-cart"]');
  138 |     
  139 |     // Step 2: Try to checkout as guest
  140 |     await page.click('[data-testid="cart-button"]');
  141 |     await page.click('[data-testid="checkout-button"]');
  142 |     
  143 |     // Should redirect to login
  144 |     await page.waitForURL('/login');
  145 |     
  146 |     // Step 3: Login and verify cart persistence
  147 |     await helpers.loginUser(testUsers.validUser);
  148 |     
  149 |     // Should redirect back to checkout with cart intact
  150 |     await page.waitForURL('/checkout');
  151 |     await expect(page.locator('[data-testid="cart-item"]')).toBeVisible();
  152 |     
  153 |     // Step 4: Verify cart merging (if applicable)
  154 |     // Cart from guest session should be preserved
  155 |     const cartItems = page.locator('[data-testid="cart-item"]');
  156 |     expect(await cartItems.count()).toBeGreaterThan(0);
  157 |   });
  158 | });
  159 |
```