# Test info

- Name: Product Discovery and Search >> Search suggestions and autocomplete
- Location: C:\Users\henry\OneDrive\Documents\uni\ICT-S4\COMP3036\Major\comp3036b2c\tests\e2e\products\optimized-products.spec.ts:86:7

# Error details

```
Error: browserContext._wrapApiCall: Test ended.
Browser logs:

<launching> C:\Users\henry\AppData\Local\ms-playwright\chromium_headless_shell-1169\chrome-win\headless_shell.exe --disable-field-trial-config --disable-background-networking --disable-background-timer-throttling --disable-backgrounding-occluded-windows --disable-back-forward-cache --disable-breakpad --disable-client-side-phishing-detection --disable-component-extensions-with-background-pages --disable-component-update --no-default-browser-check --disable-default-apps --disable-dev-shm-usage --disable-extensions --disable-features=AcceptCHFrame,AutoExpandDetailsElement,AvoidUnnecessaryBeforeUnloadCheckSync,CertificateTransparencyComponentUpdater,DeferRendererTasksAfterInput,DestroyProfileOnBrowserClose,DialMediaRouteProvider,ExtensionManifestV2Disabled,GlobalMediaControls,HttpsUpgrades,ImprovedCookieControls,LazyFrameLoading,LensOverlay,MediaRouter,PaintHolding,ThirdPartyStoragePartitioning,Translate --allow-pre-commit-input --disable-hang-monitor --disable-ipc-flooding-protection --disable-popup-blocking --disable-prompt-on-repost --disable-renderer-backgrounding --force-color-profile=srgb --metrics-recording-only --no-first-run --enable-automation --password-store=basic --use-mock-keychain --no-service-autorun --export-tagged-pdf --disable-search-engine-choice-screen --unsafely-disable-devtools-self-xss-warnings --headless --hide-scrollbars --mute-audio --blink-settings=primaryHoverType=2,availableHoverTypes=2,primaryPointerType=4,availablePointerTypes=4 --no-sandbox --user-data-dir=C:\Users\henry\AppData\Local\Temp\playwright_chromiumdev_profile-vn4t3P --remote-debugging-pipe --no-startup-window
<launched> pid=9528
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 | import { TestHelpers } from '../fixtures/testHelpers';
   3 | import { testUsers, searchQueries } from '../fixtures/testData';
   4 |
   5 | test.describe('Product Discovery and Search', () => {
   6 |   let helpers: TestHelpers;
   7 |
   8 |   test.beforeEach(async ({ page }) => {
   9 |     helpers = new TestHelpers(page);
   10 |   });
   11 |
   12 |   test('Product search and filtering workflow', async ({ page }) => {
   13 |     await page.goto('/');
   14 |     await page.waitForLoadState('networkidle');
   15 |
   16 |     // Step 1: Search functionality
   17 |     const searchInput = page.locator('[data-testid="search-input"]');
   18 |     await searchInput.fill('shirt');
   19 |     await page.keyboard.press('Enter');
   20 |     
   21 |     await page.waitForLoadState('networkidle');
   22 |     
   23 |     // Verify search results
   24 |     const searchResults = page.locator('[data-testid="product-card"]');
   25 |     await expect(searchResults.first()).toBeVisible();
   26 |     
   27 |     // Step 2: Filter by category
   28 |     const categoryFilter = page.locator('[data-testid="category-filter"]');
   29 |     if (await categoryFilter.isVisible()) {
   30 |       await categoryFilter.selectOption('Clothing');
   31 |       await page.waitForLoadState('networkidle');
   32 |     }
   33 |     
   34 |     // Step 3: Sort products
   35 |     const sortSelect = page.locator('[data-testid="sort-select"]');
   36 |     if (await sortSelect.isVisible()) {
   37 |       await sortSelect.selectOption('price-asc');
   38 |       await page.waitForLoadState('networkidle');
   39 |     }
   40 |     
   41 |     // Verify search and filter features work
   42 |     expect(await searchResults.count()).toBeGreaterThan(0);
   43 |   });
   44 |
   45 |   test('Product detail view and variant selection', async ({ page }) => {
   46 |     await page.goto('/');
   47 |     await page.waitForLoadState('networkidle');
   48 |     
   49 |     // Step 1: Navigate to product detail
   50 |     const products = page.locator('[data-testid="product-card"]');
   51 |     await products.first().click();
   52 |     
   53 |     await expect(page.locator('[data-testid="product-detail"]')).toBeVisible();
   54 |     
   55 |     // Step 2: Test variant selection
   56 |     const sizeSelector = page.locator('[data-testid="size-selector"]');
   57 |     const colorSelector = page.locator('[data-testid="color-selector"]');
   58 |     
   59 |     if (await sizeSelector.isVisible()) {
   60 |       await sizeSelector.selectOption('L');
   61 |     }
   62 |     
   63 |     if (await colorSelector.isVisible()) {
   64 |       await colorSelector.selectOption('Blue');
   65 |     }
   66 |     
   67 |     // Step 3: Check stock availability
   68 |     const stockStatus = page.locator('[data-testid="stock-status"]');
   69 |     if (await stockStatus.isVisible()) {
   70 |       const stockText = await stockStatus.textContent();
   71 |       expect(stockText).toMatch(/(in stock|out of stock)/i);
   72 |     }
   73 |     
   74 |     // Step 4: Test image gallery
   75 |     const productImages = page.locator('[data-testid="product-image"]');
   76 |     if (await productImages.count() > 1) {
   77 |       await productImages.nth(1).click();
   78 |       // Image should change
   79 |     }
   80 |     
   81 |     // Verify product detail functionality
   82 |     expect(await page.locator('[data-testid="product-name"]').isVisible()).toBe(true);
   83 |     expect(await page.locator('[data-testid="product-price"]').isVisible()).toBe(true);
   84 |   });
   85 |
>  86 |   test('Search suggestions and autocomplete', async ({ page }) => {
      |       ^ Error: browserContext._wrapApiCall: Test ended.
   87 |     await page.goto('/');
   88 |     
   89 |     // Step 1: Test search suggestions
   90 |     const searchInput = page.locator('[data-testid="search-input"]');
   91 |     await searchInput.fill('sh');
   92 |     
   93 |     // Wait for suggestions to appear
   94 |     const suggestions = page.locator('[data-testid="search-suggestions"]');
   95 |     if (await suggestions.isVisible()) {
   96 |       const suggestionItems = suggestions.locator('[data-testid="suggestion-item"]');
   97 |       if (await suggestionItems.count() > 0) {
   98 |         await suggestionItems.first().click();
   99 |         
  100 |         // Should navigate to search results
  101 |         await page.waitForLoadState('networkidle');
  102 |         await expect(page.locator('[data-testid="search-results"]')).toBeVisible();
  103 |       }
  104 |     }
  105 |     
  106 |     // Step 2: Test empty search
  107 |     await searchInput.clear();
  108 |     await searchInput.fill('nonexistentproduct123');
  109 |     await page.keyboard.press('Enter');
  110 |     
  111 |     await page.waitForLoadState('networkidle');
  112 |     
  113 |     // Should show no results message
  114 |     const noResults = page.locator('[data-testid="no-results"]');
  115 |     if (await noResults.isVisible()) {
  116 |       expect(await noResults.textContent()).toContain('No products found');
  117 |     }
  118 |   });
  119 |
  120 |   test('Product comparison and wishlist features', async ({ page }) => {
  121 |     await helpers.loginUser(testUsers.validUser);
  122 |     await page.goto('/');
  123 |     await page.waitForLoadState('networkidle');
  124 |     
  125 |     // Step 1: Add products to comparison
  126 |     const products = page.locator('[data-testid="product-card"]');
  127 |     const productCount = await products.count();
  128 |     
  129 |     if (productCount >= 2) {
  130 |       // Add first product to comparison
  131 |       await products.first().hover();
  132 |       const compareBtn1 = products.first().locator('[data-testid="compare-button"]');
  133 |       if (await compareBtn1.isVisible()) {
  134 |         await compareBtn1.click();
  135 |       }
  136 |       
  137 |       // Add second product to comparison
  138 |       await products.nth(1).hover();
  139 |       const compareBtn2 = products.nth(1).locator('[data-testid="compare-button"]');
  140 |       if (await compareBtn2.isVisible()) {
  141 |         await compareBtn2.click();
  142 |       }
  143 |       
  144 |       // View comparison
  145 |       const viewCompareBtn = page.locator('[data-testid="view-comparison"]');
  146 |       if (await viewCompareBtn.isVisible()) {
  147 |         await viewCompareBtn.click();
  148 |         await expect(page.locator('[data-testid="product-comparison"]')).toBeVisible();
  149 |       }
  150 |     }
  151 |     
  152 |     // Step 2: Test wishlist functionality
  153 |     await page.goto('/');
  154 |     const firstProduct = products.first();
  155 |     await firstProduct.hover();
  156 |     
  157 |     const wishlistBtn = firstProduct.locator('[data-testid="wishlist-button"]');
  158 |     if (await wishlistBtn.isVisible()) {
  159 |       await wishlistBtn.click();
  160 |       
  161 |       // Verify added to wishlist
  162 |       await expect(wishlistBtn).toHaveClass(/active|added/);
  163 |       
  164 |       // View wishlist
  165 |       const wishlistLink = page.locator('[data-testid="wishlist-link"]');
  166 |       if (await wishlistLink.isVisible()) {
  167 |         await wishlistLink.click();
  168 |         await expect(page.locator('[data-testid="wishlist-items"]')).toBeVisible();
  169 |       }
  170 |     }
  171 |   });
  172 |
  173 |   test('Mobile product browsing experience', async ({ page }) => {
  174 |     // Set mobile viewport
  175 |     await page.setViewportSize({ width: 375, height: 667 });
  176 |     
  177 |     await page.goto('/');
  178 |     await page.waitForLoadState('networkidle');
  179 |     
  180 |     // Step 1: Test mobile navigation
  181 |     const mobileMenuToggle = page.locator('[data-testid="mobile-menu-toggle"]');
  182 |     if (await mobileMenuToggle.isVisible()) {
  183 |       await mobileMenuToggle.click();
  184 |       await expect(page.locator('[data-testid="mobile-menu"]')).toBeVisible();
  185 |       
  186 |       // Test category navigation on mobile
```