# Test info

- Name: Authentication System >> Protected routes and redirects
- Location: C:\Users\henry\OneDrive\Documents\uni\ICT-S4\COMP3036\Major\comp3036b2c\tests\e2e\auth\optimized-auth.spec.ts:95:7

# Error details

```
TimeoutError: page.goto: Timeout 10000ms exceeded.
Call log:
  - navigating to "http://localhost:3000/checkout", waiting until "load"

    at C:\Users\henry\OneDrive\Documents\uni\ICT-S4\COMP3036\Major\comp3036b2c\tests\e2e\auth\optimized-auth.spec.ts:97:16
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 | import { TestHelpers } from '../fixtures/testHelpers';
   3 | import { testUsers } from '../fixtures/testData';
   4 |
   5 | test.describe('Authentication System', () => {
   6 |   let helpers: TestHelpers;
   7 |
   8 |   test.beforeEach(async ({ page }) => {
   9 |     helpers = new TestHelpers(page);
   10 |   });
   11 |
   12 |   test('Authentication flow: login → logout → register → validation', async ({ page }) => {
   13 |     // Step 1: Valid login
   14 |     await page.goto('/');
   15 |     await page.click('[data-testid="login-button"]');
   16 |     
   17 |     await page.fill('[data-testid="login-email"]', testUsers.validUser.email);
   18 |     await page.fill('[data-testid="login-password"]', testUsers.validUser.password);
   19 |     await page.click('[data-testid="login-submit"]');
   20 |     
   21 |     // Verify login success
   22 |     await expect(page.locator('[data-testid="user-menu"]')).toBeVisible({ timeout: 3000 });
   23 |     
   24 |     // Step 2: Logout
   25 |     await page.click('[data-testid="user-menu"]');
   26 |     await page.click('[data-testid="logout-button"]');
   27 |     await expect(page.locator('[data-testid="login-button"]')).toBeVisible({ timeout: 2000 });
   28 |     
   29 |     // Step 3: Invalid login attempt
   30 |     await page.click('[data-testid="login-button"]');
   31 |     await page.fill('[data-testid="login-email"]', 'invalid@example.com');
   32 |     await page.fill('[data-testid="login-password"]', 'wrongpassword');
   33 |     await page.click('[data-testid="login-submit"]');
   34 |     
   35 |     // Verify error message
   36 |     await expect(page.locator('[data-testid="error-message"]')).toBeVisible();
   37 |     
   38 |     // Step 4: Registration with validation
   39 |     await page.click('[data-testid="switch-to-register"]');
   40 |     
   41 |     // Test empty fields validation
   42 |     await page.click('[data-testid="register-submit"]');
   43 |     await expect(page.locator('[data-testid="validation-error"]')).toBeVisible();
   44 |     
   45 |     // Test invalid email format
   46 |     await page.fill('[data-testid="register-email"]', 'invalid-email');
   47 |     await page.click('[data-testid="register-submit"]');
   48 |     await expect(page.locator('[data-testid="validation-error"]')).toBeVisible();
   49 |     
   50 |     // Step 5: Password visibility toggle
   51 |     await page.fill('[data-testid="register-password"]', 'testpass');
   52 |     const passwordField = page.locator('[data-testid="register-password"]');
   53 |     
   54 |     // Initially password should be hidden
   55 |     expect(await passwordField.getAttribute('type')).toBe('password');
   56 |     
   57 |     // Toggle visibility
   58 |     await page.click('[data-testid="toggle-password"]');
   59 |     expect(await passwordField.getAttribute('type')).toBe('text');
   60 |     
   61 |     // Verify all authentication features work
   62 |     expect(await page.locator('[data-testid="login-button"]').isVisible()).toBe(true);
   63 |   });
   64 |
   65 |   test('Admin authentication and authorization', async ({ page }) => {
   66 |     // Step 1: Admin login
   67 |     await helpers.loginUser(testUsers.admin);
   68 |     
   69 |     // Step 2: Access admin routes
   70 |     await page.goto('/admin');
   71 |     await expect(page.locator('[data-testid="admin-dashboard"]')).toBeVisible();
   72 |     
   73 |     // Step 3: Verify admin-only features
   74 |     await expect(page.locator('[data-testid="admin-products-link"]')).toBeVisible();
   75 |     await expect(page.locator('[data-testid="admin-orders-link"]')).toBeVisible();
   76 |     
   77 |     // Step 4: Logout and verify access restriction
   78 |     await helpers.logout();
   79 |     
   80 |     // Try to access admin route as guest
   81 |     await page.goto('/admin');
   82 |     await page.waitForURL('/login');
   83 |     
   84 |     // Step 5: Login as regular user and verify no admin access
   85 |     await helpers.loginUser(testUsers.validUser);
   86 |     await page.goto('/admin');
   87 |     
   88 |     // Should redirect or show unauthorized
   89 |     const isRedirected = page.url().includes('/login') || page.url() === '/';
   90 |     const hasUnauthorized = await page.locator('[data-testid="unauthorized"]').isVisible().catch(() => false);
   91 |     
   92 |     expect(isRedirected || hasUnauthorized).toBe(true);
   93 |   });
   94 |
   95 |   test('Protected routes and redirects', async ({ page }) => {
   96 |     // Step 1: Try accessing protected route without login
>  97 |     await page.goto('/checkout');
      |                ^ TimeoutError: page.goto: Timeout 10000ms exceeded.
   98 |     await page.waitForURL('/login');
   99 |     
  100 |     // Step 2: Login and verify redirect to intended page
  101 |     await page.fill('[data-testid="login-email"]', testUsers.validUser.email);
  102 |     await page.fill('[data-testid="login-password"]', testUsers.validUser.password);
  103 |     await page.click('[data-testid="login-submit"]');
  104 |     
  105 |     // Should redirect back to checkout after login
  106 |     await page.waitForURL('/checkout');
  107 |     
  108 |     // Step 3: Verify other protected routes
  109 |     const protectedRoutes = ['/order-summary', '/admin'];
  110 |     
  111 |     for (const route of protectedRoutes) {
  112 |       await helpers.logout();
  113 |       await page.goto(route);
  114 |       
  115 |       // Should redirect to login
  116 |       await page.waitForURL('/login');
  117 |       
  118 |       await helpers.loginUser(route === '/admin' ? testUsers.admin : testUsers.validUser);
  119 |       
  120 |       if (route !== '/admin' || testUsers.admin) {
  121 |         // Should be able to access the route
  122 |         await page.goto(route);
  123 |         expect(page.url()).toContain(route);
  124 |       }
  125 |     }
  126 |   });
  127 | });
  128 |
```