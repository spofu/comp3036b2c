# Test info

- Name: Session Management >> should handle expired session gracefully
- Location: C:\Users\henry\OneDrive\Documents\uni\ICT-S4\COMP3036\Major\comp3036b2c\tests\e2e\auth\session.spec.ts:77:7

# Error details

```
Error: Timed out 5000ms waiting for expect(locator).toHaveURL(expected)

Locator: locator(':root')
Expected pattern: /.*login.*/
Received string:  "http://localhost:3000/cart"
Call log:
  - expect.toHaveURL with timeout 5000ms
  - waiting for locator(':root')
    8 × locator resolved to <html lang="en">…</html>
      - unexpected value "http://localhost:3000/cart"

    at C:\Users\henry\OneDrive\Documents\uni\ICT-S4\COMP3036\Major\comp3036b2c\tests\e2e\auth\session.spec.ts:96:24
```

# Page snapshot

```yaml
- banner:
  - navigation:
    - link "CLOOOOTHES":
      - /url: /
      - paragraph: CLOOOOTHES
    - textbox "Search products..."
    - link "Shopping Cart":
      - /url: /cart
      - img "Shopping Cart"
    - link "Login":
      - /url: /login
- main:
  - img
  - heading "Your cart is empty" [level=2]
  - paragraph: Looks like you haven't added anything to your cart yet.
  - button "Continue Shopping":
    - link "Continue Shopping":
      - /url: /
- contentinfo:
  - contentinfo:
    - heading "CLOOOOTHES" [level=3]
    - paragraph: Discover the latest trends in fashion with our curated collections for men, women, and kids.
    - link "Facebook":
      - /url: "#"
    - link "Instagram":
      - /url: "#"
    - link "Twitter":
      - /url: "#"
    - heading "Shop" [level=3]
    - list:
      - listitem:
        - link "Shop our collection.":
          - /url: /
    - heading "Support" [level=3]
    - list:
      - listitem:
        - link "Contact Us":
          - /url: /contact
      - listitem:
        - link "FAQ":
          - /url: /faq
      - listitem:
        - link "Shipping & Returns":
          - /url: /shipping
      - listitem:
        - link "Size Guide":
          - /url: /size-guide
      - listitem:
        - link "Track Order":
          - /url: /track-order
    - heading "Contact" [level=3]
    - paragraph:
      - img
      - text: 123 Fashion Street, London, UK
    - paragraph:
      - img
      - text: +44 1234 567890
    - paragraph:
      - img
      - text: support@ecommercetype.com
    - text: VISA MC AMEX PayPal Apple
    - paragraph: © 2025 E-Commerce Type Shii. All rights reserved.
    - link "Privacy Policy":
      - /url: /privacy
    - link "Terms of Service":
      - /url: /terms
    - link "Returns Policy":
      - /url: /returns
- alert
- button "Open Next.js Dev Tools":
  - img
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 |
   3 | const TEST_USER = {
   4 |   email: 'customer@example.com',
   5 |   password: 'password123'
   6 | };
   7 |
   8 | test.describe('Session Management', () => {
   9 |   
  10 |   test('should persist login after page refresh', async ({ page }) => {
  11 |     // Login
  12 |     await page.goto('/login');
  13 |     await page.fill('input[type="email"]', TEST_USER.email);
  14 |     await page.fill('input[type="password"]', TEST_USER.password);
  15 |     await page.click('button[type="submit"]');
  16 |     
  17 |     // Verify logged in
  18 |     await expect(page.locator('text=Logout')).toBeVisible();
  19 |     
  20 |     // Refresh page
  21 |     await page.reload();
  22 |     
  23 |     // Should still be logged in
  24 |     await expect(page.locator('text=Logout')).toBeVisible();
  25 |     await expect(page.locator('text=Login')).not.toBeVisible();
  26 |   });
  27 |
  28 |   test('should persist login across browser tabs', async ({ context }) => {
  29 |     const page1 = await context.newPage();
  30 |     const page2 = await context.newPage();
  31 |     
  32 |     // Login in first tab
  33 |     await page1.goto('/login');
  34 |     await page1.fill('input[type="email"]', TEST_USER.email);
  35 |     await page1.fill('input[type="password"]', TEST_USER.password);
  36 |     await page1.click('button[type="submit"]');
  37 |     
  38 |     // Verify logged in
  39 |     await expect(page1.locator('text=Logout')).toBeVisible();
  40 |     
  41 |     // Navigate to home in second tab
  42 |     await page2.goto('/');
  43 |     
  44 |     // Should be logged in second tab too
  45 |     await expect(page2.locator('text=Logout')).toBeVisible();
  46 |     
  47 |     await page1.close();
  48 |     await page2.close();
  49 |   });
  50 |
  51 |   test('should logout from all tabs when logging out from one', async ({ context }) => {
  52 |     const page1 = await context.newPage();
  53 |     const page2 = await context.newPage();
  54 |     
  55 |     // Login in first tab
  56 |     await page1.goto('/login');
  57 |     await page1.fill('input[type="email"]', TEST_USER.email);
  58 |     await page1.fill('input[type="password"]', TEST_USER.password);
  59 |     await page1.click('button[type="submit"]');
  60 |     
  61 |     // Navigate to home in second tab
  62 |     await page2.goto('/');
  63 |     await expect(page2.locator('text=Logout')).toBeVisible();
  64 |     
  65 |     // Logout from first tab
  66 |     await page1.click('text=Logout');
  67 |     await expect(page1.locator('text=Login')).toBeVisible();
  68 |     
  69 |     // Refresh second tab - should be logged out
  70 |     await page2.reload();
  71 |     await expect(page2.locator('text=Login')).toBeVisible();
  72 |     
  73 |     await page1.close();
  74 |     await page2.close();
  75 |   });
  76 |
  77 |   test('should handle expired session gracefully', async ({ page }) => {
  78 |     // This test would require manipulating JWT tokens or waiting for expiration
  79 |     // For now, we'll test the basic flow
  80 |     
  81 |     await page.goto('/login');
  82 |     await page.fill('input[type="email"]', TEST_USER.email);
  83 |     await page.fill('input[type="password"]', TEST_USER.password);
  84 |     await page.click('button[type="submit"]');
  85 |     
  86 |     // Clear localStorage to simulate expired session
  87 |     await page.evaluate(() => {
  88 |       localStorage.clear();
  89 |       sessionStorage.clear();
  90 |     });
  91 |     
  92 |     // Try to access protected route
  93 |     await page.goto('/cart');
  94 |     
  95 |     // Should redirect to login
> 96 |     await expect(page).toHaveURL(/.*login.*/);
     |                        ^ Error: Timed out 5000ms waiting for expect(locator).toHaveURL(expected)
  97 |   });
  98 | });
  99 |
```